<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Flipper Web Control</title>
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<style>
			/* simple, slightly stylish UI */
			:root {
				--bg: #0f1720;
				--card: #0b1220;
				--accent: #6ee7b7;
				--muted: #9aa6b2;
				--danger: #ff6b6b;
				--glass: rgba(255, 255, 255, 0.03);
				font-family: Inter, ui-sans-serif, system-ui, -apple-system,
					"Segoe UI", Roboto, "Helvetica Neue", Arial;
			}
			body {
				margin: 0;
				min-height: 100vh;
				display: flex;
				align-items: center;
				justify-content: center;
				background: linear-gradient(180deg, #061018 0%, #071424 100%);
				color: #e6eef3;
			}
			.card {
				width: min(720px, 94vw);
				background: linear-gradient(180deg, var(--card), #07101a);
				padding: 22px;
				border-radius: 12px;
				box-shadow: 0 10px 30px rgba(2, 6, 23, 0.6);
				border: 1px solid rgba(255, 255, 255, 0.03);
			}
			h1 {
				margin: 0 0 8px 0;
				font-size: 20px;
				display: flex;
				gap: 10px;
				align-items: center;
			}
			p.lead {
				margin: 0 0 18px 0;
				color: var(--muted);
				font-size: 13px;
			}
			.row {
				display: flex;
				gap: 12px;
			}
			.col {
				flex: 1;
			}
			input[type="password"] {
				width: 100%;
				padding: 10px 12px;
				border-radius: 8px;
				border: 1px solid rgba(255, 255, 255, 0.04);
				background: var(--glass);
				color: inherit;
				outline: none;
				font-size: 14px;
			}
			button {
				padding: 10px 16px;
				border-radius: 8px;
				border: 0;
				cursor: pointer;
				font-weight: 600;
				background: linear-gradient(90deg, var(--accent), #2dd4bf);
				color: #02121a;
			}
			.status {
				margin-top: 12px;
				color: var(--muted);
				font-size: 13px;
			}
			pre.output {
				margin-top: 14px;
				padding: 12px;
				border-radius: 8px;
				background: #07121a;
				color: #cfeee1;
				white-space: pre-wrap;
				font-family: monospace;
			}
			.small {
				font-size: 12px;
				color: var(--muted);
			}
			.error {
				color: var(--danger);
			}
			.connected-dot {
				display: inline-block;
				width: 10px;
				height: 10px;
				border-radius: 50%;
				margin-right: 8px;
				vertical-align: middle;
			}
			.connected {
				background: #19d66d;
				box-shadow: 0 0 6px rgba(25, 214, 109, 0.2);
			}
			.disconnected {
				background: #8b97a4;
			}
		</style>
	</head>
	<body>
		<div class="card">
			<h1>
				Flipper Web Control
				<span class="small">â€” simple local test UI</span>
			</h1>
			<p class="lead">
				Enter password and press <strong>Send Hello</strong>. The
				password is hashed client-side (SHA-256) and the hash is sent to
				the server for verification.
			</p>

			<div class="row">
				<div class="col">
					<label class="small">Password</label>
					<input
						id="pw"
						type="password"
						placeholder="Type password..."
					/>
				</div>
				<div style="width: 140px">
					<label class="small">&nbsp;</label><br />
					<button id="btn">Send Hello</button>
				</div>
			</div>

			<div class="status">
				<span
					id="conn"
					class="connected-dot {{ 'connected' if connected else 'disconnected'}}"
				></span>
				<span id="status-text"
					>{{ 'Connected to ' + device if connected else 'Flipper not
					connected' }}</span
				>
			</div>

			<div id="result" class="status"></div>

			<pre class="output" id="output">Output will appear here...</pre>

			<p class="small" style="margin-top: 12px">
				Note: This UI is intentionally minimal. Do not expose it to the
				public internet.
			</p>
		</div>

		<script>
			async function sha256hex(str) {
				const encoder = new TextEncoder();
				const data = encoder.encode(str);
				const hashBuf = await crypto.subtle.digest("SHA-256", data);
				const hashArray = Array.from(new Uint8Array(hashBuf));
				return hashArray
					.map((b) => b.toString(16).padStart(2, "0"))
					.join("");
			}

			document
				.getElementById("btn")
				.addEventListener("click", async (e) => {
					const pw = document.getElementById("pw").value || "";
					const out = document.getElementById("output");
					const result = document.getElementById("result");

					result.textContent = "Hashing password...";
					try {
						const h = await sha256hex(pw);
						result.textContent = "Sending hash to server...";
						const resp = await fetch("/send", {
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify({ hash: h }),
						});
						const j = await resp.json();
						if (j.ok) {
							result.textContent = "Success: command sent";
							out.textContent = j.response || "(no response)";
						} else {
							result.textContent =
								"Error: " + (j.error || "unknown");
							out.textContent = "";
						}
					} catch (err) {
						result.textContent = "Client error: " + err;
						out.textContent = "";
					}
				});
		</script>
	</body>
</html>
